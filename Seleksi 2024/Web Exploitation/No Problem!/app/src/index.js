const express = require('express');
const path = require('path');
const fs = require('fs');

const app = express();
const port = process.env.PORT || 3000;

let data = JSON.parse(fs.readFileSync(path.join(__dirname, 'data.json'), 'utf8'));

function views(filename) {
    return path.join(__dirname, 'views', filename + '.html');
}

app.use(express.json());

app.get('/', async (req, res) => {
    res.sendFile(views('index'));
});

app.post("/api", (req, res) => {
    let name = req.body.name;    

    if (name) {
        res.json(
            (name in data) ? 
                {success: true, data: data[name]} : 
                {success: false, message: `No information available for ${name}!`}
        );
        return;
    }

    res.json({success: false, message: 'No data send!'});
});

app.listen(port, () => {
    console.log(`Server running at http://localhost:${port}`);
});